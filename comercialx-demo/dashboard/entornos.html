<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Auditor√≠a por Entorno</title>
  <link rel="stylesheet" href="../assets/style.css">
</head>
<body>
  <h1>üåê Auditor√≠a por Entorno</h1>

  <label for="entorno">üß≠ Selecciona entorno:</label>
  <select id="entorno" onchange="cargarEntorno()">
    <option value="local">Local</option>
    <option value="cloud">Cloud</option>
    <option value="netlify">Netlify</option>
    <option value="github">GitHub Pages</option>
  </select>

  <div id="badge" style="margin: 1em 0;"></div>

  <table id="tabla">
    <thead>
      <tr>
        <th>Ruta</th>
        <th>Estado</th>
        <th>Detalles</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    function cargarEntorno() {
      const entorno = document.getElementById('entorno').value;
      fetch(\`../logs/logs-\${entorno}.json\`)
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector('#tabla tbody');
          tbody.innerHTML = '';
          let errores = 0;

          data.forEach(log => {
            if (log.estado !== 200) errores++;
            tbody.innerHTML += \`<tr>
              <td>\${log.ruta}</td>
              <td>\${log.estado}</td>
              <td>\${log.detalles}</td>
              <td>\${log.timestamp}</td>
            </tr>\`;
          });

          const badge = document.getElementById('badge');
          const estado = errores === 0 ? 'ok' : errores > 2 ? 'error' : 'warning';
          badge.innerHTML = \`<img src="../badges/badge-\${entorno}-\${estado}.svg" alt="Estado \${entorno}" />\`;
        })
        .catch(() => {
          document.querySelector('#tabla tbody').innerHTML = '<tr><td colspan="4">‚ö†Ô∏è No se pudo cargar el log</td></tr>';
          document.getElementById('badge').innerHTML = \`<img src="../badges/badge-\${entorno}-error.svg" alt="Error \${entorno}" />\`;
        });
    }

    cargarEntorno(); // inicial
  </script>
</body>
</html>
