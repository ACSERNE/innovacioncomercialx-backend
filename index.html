<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Cockpit | ComercialX (Dev)</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #f0f0f0; }
    h2, h3 { color: #222; margin-top: 2rem; }
    select, button { margin: 0.5rem; padding: 0.5rem; font-size: 1rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    .section { margin-top: 3rem; }
    .precio { font-weight: bold; color: #007700; margin-top: 1rem; }
    label { font-weight: bold; margin-right: 0.5rem; }
    pre.logo { font-family: "Courier New", monospace; text-align:center; background:#fff; padding:1rem; border-bottom:2px solid #ddd; }
  </style>
</head>
<body>

  <!-- Logo ASCII desarrollo -->
  <pre class="logo">
   ____                            _        _  __  __
  / ___|___  _ __ ___  _ __   ___ | |_ __ _| ||  \/  |
 | |   / _ \| '_ ` _ \| '_ \ / _ \| __/ _` | || |\/| |
 | |__| (_) | | | | | | |_) | (_) | || (_| | || |  | |
  \____\___/|_| |_| |_| .__/ \___/ \__\__,_|_||_|  |_|
                      |_|  ComercialX Cockpit
  </pre>

  <h2>🧭 Selector cockpitizado (Dev)</h2>
  <label for="tipoFiltro">Tipo de tienda:</label>
  <select id="tipoFiltro" title="Selecciona tipo de tienda" onchange="mostrarPrecio()">
    <option value="">Todos los tipos</option>
    <option value="fisica">🏪 Física</option>
    <option value="online">🛒 Online</option>
    <option value="hibrida">🔀 Híbrida</option>
    <option value="demo">🎁 Demo</option>
  </select>

  <label for="entornoFiltro">Entorno:</label>
  <select id="entornoFiltro" title="Selecciona entorno">
    <option value="">Todos los entornos</option>
    <option value="dev">Dev</option>
    <option value="prod">Prod</option>
    <option value="test">Test</option>
  </select>

  <div id="precioSeleccionado" class="precio">💲 Precio: —</div>

  <button onclick="filtrarLog()">🔍 Filtrar log</button>
  <button onclick="exportarCSV()">📄 Exportar CSV</button>
  <button onclick="activarOnboarding()">🚀 Activar Onboarding</button>

  <div class="section">
    <h3>📊 Log técnico tabular</h3>
    <table id="tablaLog">
      <thead><tr><th>Fecha</th><th>Tipo</th><th>Entorno</th><th>Acción</th><th>Precio</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    let logData=[];
    const precios={fisica:"$69.990",online:"$59.990",hibrida:"$89.990",demo:"🎁 Gratis"};

    function mostrarPrecio(){
      const tipo=document.getElementById('tipoFiltro').value;
      document.getElementById('precioSeleccionado').innerText=`💲 Precio: ${precios[tipo]||"—"}`;
    }

    function cargarLog(){
      fetch('exports/onboarding/onboarding.log')
        .then(r=>r.text())
        .then(data=>{
          logData=data.trim().split('\n').map(l=>{
            const [fecha,tipo,entorno,accion,precio]=l.split('|'); return {fecha,tipo,entorno,accion,precio};
          }).filter(Boolean);
          renderizarTabla(logData);
        }).catch(e=>console.error("⚠️ Error al cargar log:",e));
    }

    function renderizarTabla(data){
      const tbody=document.querySelector('#tablaLog tbody'); tbody.innerHTML='';
      data.forEach(e=>{tbody.innerHTML+=`<tr><td>${e.fecha}</td><td>${e.tipo}</td><td>${e.entorno}</td><td>${e.accion}</td><td>${e.precio}</td></tr>`;});
    }

    function filtrarLog(){
      const tipo=document.getElementById('tipoFiltro').value;
      const entorno=document.getElementById('entornoFiltro').value;
      renderizarTabla(logData.filter(e=>(!tipo||e.tipo===tipo)&&(!entorno||e.entorno===entorno)));
    }

    function exportarCSV(){
      const csv=logData.map(e=>`${e.fecha},${e.tipo},${e.entorno},${e.accion},${e.precio}`).join('\n');
      const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob);
      const a=document.createElement('a'); a.href=url; a.download='onboarding.csv'; a.click(); URL.revokeObjectURL(url);
    }

    function activarOnboarding(){
      const tipo=document.getElementById('tipoFiltro').value;
      const entorno=document.getElementById('entornoFiltro').value;
      if(!tipo||!entorno){alert("Selecciona tipo de tienda y entorno."); return;}
      const fecha=new Date().toISOString().split('T')[0]; const accion="Onboarding activado"; const precio=precios[tipo]||"—";
      logData.push({fecha,tipo,entorno,accion,precio}); renderizarTabla(logData);
      alert(`✅ ${accion} para ${tipo} en ${entorno} con precio ${precio}`);
    }

    window.onload=cargarLog;
  </script>

</body>
</html>
